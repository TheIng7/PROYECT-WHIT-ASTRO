---
// src/components/features/EventCard.astro
import OddsButton from './OddsButton.astro';

export interface Props {
  eventId: string;
  homeTeam: string;
  awayTeam: string;
  homeOdds: number;
  drawOdds: number;
  awayOdds: number;
  league?: string;
  date?: string;
}

const { 
  eventId, 
  homeTeam, 
  awayTeam, 
  homeOdds, 
  drawOdds, 
  awayOdds, 
  league = "La Liga",
  date = "Hoy" 
} = Astro.props;
---

<article class="event-card" data-event-id={eventId}>
  <!-- Header del Evento -->
  <div class="event-header">
    <span class="league-badge">{league}</span>
    <span class="event-date">{date}</span>
  </div>

  <!-- Equipos -->
  <div class="teams-section">
    <div class="team home-team">
      <span class="team-name">{homeTeam}</span>
    </div>
    
    <div class="vs-separator">
      <span>VS</span>
    </div>
    
    <div class="team away-team">
      <span class="team-name">{awayTeam}</span>
    </div>
  </div>

  <!-- Odds -->
  <div class="odds-section">
    <OddsButton 
      odds={homeOdds} 
      outcome="home" 
      eventId={eventId}
    />
    
    <OddsButton 
      odds={drawOdds} 
      outcome="draw" 
      eventId={eventId}
    />
    
    <OddsButton 
      odds={awayOdds} 
      outcome="away" 
      eventId={eventId}
    />
  </div>
</article>

<script>
  // Gestión de eventos y estado de la card
  class EventCard extends HTMLElement {
    constructor() {
      super();
      this.selectedOdds = null;
    }

    connectedCallback() {
      this.setupEventListeners();
      this.setupHoverEffects();
    }

    setupEventListeners() {
      // Escuchar eventos de los OddsButton hijos
      this.addEventListener('oddsSelected', (event) => {
        this.handleOddsSelection(event.detail);
      });
    }

    handleOddsSelection(oddsData) {
      // Deseleccionar odds previos si existen
      if (this.selectedOdds && this.selectedOdds !== oddsData.element) {
        this.selectedOdds.deselect();
      }

      this.selectedOdds = oddsData.element;
      
      // Disparar evento a nivel de card
      const eventCardSelection = new CustomEvent('eventCardSelection', {
        detail: {
          eventId: this.dataset.eventId,
          homeTeam: this.querySelector('.home-team .team-name').textContent,
          awayTeam: this.querySelector('.away-team .team-name').textContent,
          ...oddsData
        },
        bubbles: true
      });
      
      this.dispatchEvent(eventCardSelection);
    }

    setupHoverEffects() {
      this.addEventListener('mouseenter', () => {
        this.style.transform = 'translateY(-4px)';
        this.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.15)';
      });

      this.addEventListener('mouseleave', () => {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';
      });
    }

    // Método para limpiar selecciones
    clearSelection() {
      if (this.selectedOdds) {
        this.selectedOdds.deselect();
        this.selectedOdds = null;
      }
    }
  }

  // Registrar el web component
  if (!customElements.get('event-card')) {
    customElements.define('event-card', EventCard);
  }
</script>

<style>
  .event-card {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    border: 1px solid #475569;
    border-radius: 12px;
    padding: 1.25rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
  }

  .event-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #00c8ff, #0099cc);
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }

  .event-card:hover::before {
    transform: scaleX(1);
  }

  /* Header del Evento */
  .event-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #475569;
  }

  .league-badge {
    background: linear-gradient(135deg, #00c8ff, #0099cc);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .event-date {
    color: #94a3b8;
    font-size: 0.8rem;
    font-weight: 500;
  }

  /* Sección de Equipos */
  .teams-section {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.25rem;
  }

  .team {
    text-align: center;
    padding: 0.5rem;
  }

  .team-name {
    color: white;
    font-weight: 600;
    font-size: 0.95rem;
    line-height: 1.3;
    display: block;
  }

  .home-team {
    text-align: right;
  }

  .away-team {
    text-align: left;
  }

  .vs-separator {
    color: #94a3b8;
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    background: rgba(255, 255, 255, 0.05);
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    border: 1px solid #475569;
  }

  /* Sección de Odds */
  .odds-section {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 0.75rem;
    align-items: center;
  }

  /* Estados de la card */
  .event-card.has-selection {
    border-color: #00c853;
    background: linear-gradient(135deg, #1e3a2c 0%, #2d4a3d 100%);
  }

  .event-card.has-selection::before {
    background: linear-gradient(90deg, #00c853, #00a844);
    transform: scaleX(1);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .event-card {
      padding: 1rem;
    }

    .teams-section {
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .team-name {
      font-size: 0.9rem;
    }

    .vs-separator {
      font-size: 0.75rem;
      padding: 0.4rem 0.6rem;
    }

    .odds-section {
      gap: 0.5rem;
    }

    .event-header {
      margin-bottom: 0.75rem;
    }
  }

  @media (max-width: 480px) {
    .event-card {
      padding: 0.75rem;
    }

    .teams-section {
      grid-template-columns: 1fr;
      grid-template-rows: auto auto auto;
      gap: 0.5rem;
    }

    .home-team, .away-team {
      text-align: center;
    }

    .vs-separator {
      order: -1;
      margin-bottom: 0.5rem;
    }
  }
</style>