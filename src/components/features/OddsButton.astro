---
// src/components/features/OddsButton.astro
export interface Props {
  odds: number;
  outcome: 'home' | 'draw' | 'away';
  eventId: string;
  isSelected?: boolean;
}

const { odds, outcome, eventId, isSelected = false } = Astro.props;
---

<button 
  class={`odds-button ${isSelected ? 'selected' : ''}`}
  data-outcome={outcome}
  data-event-id={eventId}
  data-odds={odds}
>
  <span class="odds-value">{odds}</span>
</button>

<script>
  // Funcionalidad del botón de odds
  class OddsButton extends HTMLElement {
    constructor() {
      super();
      this.handleClick = this.handleClick.bind(this);
    }

    connectedCallback() {
      this.addEventListener('click', this.handleClick);
      this.setupHoverEffects();
    }

    disconnectedCallback() {
      this.removeEventListener('click', this.handleClick);
    }

    handleClick(event) {
      event.stopPropagation();
      
      const oddsData = {
        eventId: this.dataset.eventId,
        outcome: this.dataset.outcome,
        odds: parseFloat(this.dataset.odds),
        element: this
      };

      // Disparar evento personalizado para que BetSlip lo capture
      const oddsSelectedEvent = new CustomEvent('oddsSelected', {
        detail: oddsData,
        bubbles: true
      });
      
      this.dispatchEvent(oddsSelectedEvent);
      
      // Feedback visual inmediato
      this.animateSelection();
    }

    animateSelection() {
      this.classList.add('selected');
      
      // Efecto de pulso al seleccionar
      this.animate([
        { transform: 'scale(1)', backgroundColor: 'var(--odds-selected-bg)' },
        { transform: 'scale(1.05)', backgroundColor: 'var(--odds-selected-pulse)' },
        { transform: 'scale(1)', backgroundColor: 'var(--odds-selected-bg)' }
      ], {
        duration: 300,
        easing: 'ease-out'
      });
    }

    setupHoverEffects() {
      this.addEventListener('mouseenter', () => {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 4px 12px rgba(0, 200, 255, 0.3)';
      });

      this.addEventListener('mouseleave', () => {
        if (!this.classList.contains('selected')) {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = '0 2px 6px rgba(0, 0, 0, 0.1)';
        }
      });
    }

    // Método para deseleccionar
    deselect() {
      this.classList.remove('selected');
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 2px 6px rgba(0, 0, 0, 0.1)';
    }
  }

  // Registrar el web component si no existe
  if (!customElements.get('odds-button')) {
    customElements.define('odds-button', OddsButton);
  }
</script>

<style>
  .odds-button {
    background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
    border: 2px solid #4a5568;
    border-radius: 8px;
    color: white;
    padding: 0.75rem 1rem;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 60px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .odds-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transition: left 0.5s;
  }

  .odds-button:hover::before {
    left: 100%;
  }

  .odds-button:hover {
    border-color: #00c8ff;
    background: linear-gradient(135deg, #00c8ff 0%, #0099cc 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 200, 255, 0.3);
  }

  .odds-button.selected {
    background: linear-gradient(135deg, #00c853 0%, #00a844 100%);
    border-color: #00c853;
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(0, 200, 83, 0.4);
  }

  .odds-button:active {
    transform: translateY(0) scale(0.98);
  }

  .odds-value {
    font-weight: 700;
    font-size: 0.95rem;
  }

  /* Estados específicos por tipo de outcome */
  .odds-button[data-outcome="home"] {
    border-left: 3px solid #00c8ff;
  }

  .odds-button[data-outcome="draw"] {
    border-left: 3px solid #f59e0b;
  }

  .odds-button[data-outcome="away"] {
    border-left: 3px solid #ef4444;
  }

  .odds-button.selected[data-outcome="home"] {
    border-left: 3px solid #00c853;
  }

  .odds-button.selected[data-outcome="draw"] {
    border-left: 3px solid #d97706;
  }

  .odds-button.selected[data-outcome="away"] {
    border-left: 3px solid #dc2626;
  }

  /* Variables CSS para consistencia */
  :root {
    --odds-selected-bg: #00c853;
    --odds-selected-pulse: #00e676;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .odds-button {
      padding: 0.6rem 0.8rem;
      font-size: 0.85rem;
      min-width: 50px;
    }
    
    .odds-value {
      font-size: 0.9rem;
    }
  }
</style>